@model PolicyPro360.Models.UserClaim
@{
    ViewData["Title"] = "Claim Details - PolicyPro360";
    Layout = "_CompanyLayout";
}

<main class="main-wrapper">
    <div class="main-content">
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="breadcrumb-title pe-3">Policy Details</div>
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="@Url.Action("UserClaims", "UserPolicies")"><i class="bx bx-home-alt"></i></a></li>
                        <li class="breadcrumb-item active" aria-current="page">Details</li>
                    </ol>
                </nav>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Claim Details ID: @Model.Id</h4>
                <hr />
                <dl class="row">
                    <dt class="col-sm-3">Claim ID</dt>
                    <dd class="col-sm-9">@Model.Id</dd>

                    <dt class="col-sm-3">User Name</dt>
                    <dd class="col-sm-9">@Model.Users?.Name</dd>

                    <dt class="col-sm-3">Policy Category</dt>
                    <dd class="col-sm-9">@Model.Category?.Name</dd>

                    <dt class="col-sm-3">Policy Name</dt>
                    <dd class="col-sm-9">@Model.Policy?.Name</dd>

                    <dt class="col-sm-3">Date Of Incident</dt>
                    <dd class="col-sm-9">@Model.DateOfIncident.ToString("MM-dd-yyyy")</dd>

                    <dt class="col-sm-3">Details Of Incident</dt>
                    <dd class="col-sm-9">@Model.IncidentDetails</dd>

                    <dt class="col-sm-3">User Request</dt>
                    <dd class="col-sm-9">@Model.UserRequest</dd>

                    <dt class="col-sm-3">Claimed Amount</dt>
                    <dd class="col-sm-9">@Model.ClaimedAmount</dd>

                    <dt class="col-sm-3">Supporting Document</dt>
                    <dd class="col-sm-9"> 
                        @if (!string.IsNullOrEmpty(Model.SupportingDocumentPath))
                        {
                            var documents = Model.SupportingDocumentPath.Split(',');
                            <ul>
                                @foreach (var doc in documents)
                                {
                                    <li>
                                        <a href="@doc" target="_blank">
                                            @System.IO.Path.GetFileName(doc)
                                        </a>
                                    </li>
                                }
                            </ul>
                        }
                        else
                        {
                            <span class="text-muted">No documents uploaded</span>
                        }
                    </dd>

                    <dt class="col-sm-3">Submitted At</dt>
                    <dd class="col-sm-9">@Model.SubmittedAt.ToString("MM-dd-yyyy-hh-mm-tt")</dd>

                    <dt class="col-sm-3">Status</dt>
                    <dd class="col-sm-9">
                        <span class="badge bg-@(Model.Status == "Active" ? "success" : "secondary")">
                            @Model.Status
                        </span>
                    </dd>
                </dl>

                <div class="mt-4">
                    <a href="@Url.Action("UserClaims", "CompanyUsers")" class="btn btn-outline-secondary">Back to List</a>
                    <!-- Trigger Button -->
                    <button class="btn btn-grd-primary" data-bs-toggle="modal" data-bs-target="#changeStatusModal">
                        Change Status
                    </button>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade" id="changeStatusModal" tabindex="-1" aria-labelledby="changeStatusModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form asp-action="UpdateClaimStatus" method="post">
                            <div class="modal-header">
                                <h5 class="modal-title" id="changeStatusModalLabel">Update Claim Status</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="ClaimId" value="@Model.Id" />

                                <div class="mb-3">
                                    <label for="Status" class="form-label">Select Status</label>
                                    <select class="form-select" name="Status" required>
                                        <option value="Pending" selected>Pending</option>
                                        <option value="Processing">Processing</option>
                                        <option value="Accepted">Accepted</option>
                                        <option value="Rejected">Rejected</option>
                                    </select>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-grd-primary">Update Status</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
@section Scripts {
    <script src="~/admin/assets/plugins/datatable/js/jquery.dataTables.min.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/dataTables.bootstrap5.min.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/dataTables.buttons.min.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/buttons.bootstrap5.min.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/jszip.min.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/pdfmake.min.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/vfs_fonts.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/buttons.html5.min.js"></script>
    <script src="~/admin/assets/plugins/datatable/js/buttons.print.min.js"></script>
    <script>
        $(document).ready(function() {
                  $('#userPoliciesTable').DataTable({
            dom: '<"row align-items-center mb-3"<"col-sm-12 col-md-6"lB><"col-sm-12 col-md-6 d-flex justify-content-end"f>>' +
                 '<"row mt-3"<"col-sm-12"tr>>' +
                 '<"row mt-3"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
            lengthChange: true,
            buttons: [
                { extend: 'copy', text: '<i class="bi bi-clipboard"></i> Copy', className: 'btn btn-outline-primary btn-sm mt-3' },
                { extend: 'excel', text: '<i class="bi bi-file-earmark-excel"></i> Excel', className: 'btn btn-outline-success btn-sm mt-3' },
                { extend: 'pdf', text: '<i class="bi bi-file-earmark-pdf"></i> PDF', className: 'btn btn-outline-danger btn-sm mt-3' },
                { extend: 'print', text: '<i class="bi bi-printer"></i> Print', className: 'btn btn-outline-info btn-sm mt-3' }
            ],
          pagingType: "simple_numbers"
        });
        });
    </script>
}